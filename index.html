<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BH Merger Waveform Explorer (Pedagogical)</title>
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
  <style>
    :root { --bg:#0b0f17; --panel:#111827; --text:#e5e7eb; --muted:#9ca3af; --accent:#60a5fa; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
           background:var(--bg); color:var(--text); }
    .wrap { max-width:1100px; margin:0 auto; padding:18px; display:grid; gap:14px; grid-template-columns: 360px 1fr; }
    .card { background:var(--panel); border:1px solid rgba(255,255,255,0.06); border-radius:14px; padding:14px; }
    h1 { font-size:18px; margin:0 0 10px; }
    .row { display:flex; justify-content:space-between; gap:10px; align-items:center; margin:10px 0; }
    label { font-size:13px; color:var(--muted); }
    input[type="range"] { width: 190px; }
    .val { font-variant-numeric: tabular-nums; font-size:13px; color:var(--text); min-width:90px; text-align:right; }
    .note { color:var(--muted); font-size:12px; line-height:1.35; }
    button { cursor:pointer; border:1px solid rgba(255,255,255,0.12); background:transparent; color:var(--text);
             border-radius:10px; padding:8px 10px; }
    button:hover { border-color: rgba(96,165,250,0.6); }
    .small { font-size:12px; color:var(--muted); }
    @media (max-width: 900px) { .wrap { grid-template-columns: 1fr; } input[type="range"]{ width: 100%; } }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>BH Merger Waveform Explorer</h1>

      <div class="row">
        <label for="m1">m1 (M☉)</label>
        <input id="m1" type="range" min="5" max="100" value="35" step="1">
        <div class="val" id="m1v"></div>
      </div>

      <div class="row">
        <label for="m2">m2 (M☉)</label>
        <input id="m2" type="range" min="5" max="100" value="30" step="1">
        <div class="val" id="m2v"></div>
      </div>

      <div class="row">
        <label for="dist">Distance (Mpc)</label>
        <input id="dist" type="range" min="50" max="2000" value="400" step="10">
        <div class="val" id="distv"></div>
      </div>

      <div class="row">
        <label for="inc">Inclination ι (deg)</label>
        <input id="inc" type="range" min="0" max="90" value="30" step="1">
        <div class="val" id="incv"></div>
      </div>

      <div class="row">
        <label for="tc">Coalescence time tc (s)</label>
        <input id="tc" type="range" min="0.2" max="3.8" value="2.6" step="0.01">
        <div class="val" id="tcv"></div>
      </div>

      <div class="row">
        <label for="tau">Ringdown τ (ms)</label>
        <input id="tau" type="range" min="1" max="40" value="10" step="0.5">
        <div class="val" id="tauv"></div>
      </div>

      <div class="row">
        <label for="dur">Window length (s)</label>
        <input id="dur" type="range" min="1.0" max="8.0" value="4.0" step="0.1">
        <div class="val" id="durv"></div>
      </div>

      <div class="row">
        <label for="fs">Sample rate (Hz)</label>
        <input id="fs" type="range" min="256" max="4096" value="1024" step="256">
        <div class="val" id="fsv"></div>
      </div>

      <div class="row" style="margin-top:14px;">
        <button id="reset">Reset</button>
        <div class="small" id="derived"></div>
      </div>
        <div class="row">
        <label for="flow">Detector f_low (Hz)</label>
        <input id="flow" type="range" min="1" max="100" value="20" step="1">
        <div class="val" id="flowv"></div>
      </div>

      <div class="row">
        <label for="fhigh">Detector f_high (Hz)</label>
        <input id="fhigh" type="range" min="50" max="2000" value="512" step="1">
        <div class="val" id="fhighv"></div>
      </div>

      <p class="note">
        Model: a fast, browser-friendly <b>pedagogical IMR-like waveform</b> (inspiral chirp + smooth merger + damped ringdown).
        For outreach/intuition it’s great; for data analysis you’d use LALSuite/IMRPhenom etc.
      </p>
    </div>

    <div class="card">
      <div id="plot" style="height:520px;"></div>
      <div class="note">
        Tip: make the masses heavier → waveform gets shorter and “lower pitched”. Increase distance → smaller amplitude.
      </div>
    </div>
  </div>

<script>
(() => {
  // ---------- UI helpers ----------
  const $ = (id) => document.getElementById(id);
  const sliders = ["m1","m2","dist","inc","tc","tau","dur","fs","flow","fhigh"].map($);
  const setVal = (id, txt) => $(id+"v").textContent = txt;

  const defaults = { m1:35, m2:30, dist:400, inc:30, tc:2.6, tau:10, dur:4.0, fs:1024, flow:20, fhigh:512 };

  // ---------- Physics-ish helpers (pedagogical) ----------
  const PI = Math.PI;
  const G = 6.67430e-11;                 // SI
  const c = 299792458;                   // SI
  const MSUN = 1.98847e30;               // kg
  const MPC = 3.0856775814913673e22;     // m

  function clamp(x,a,b){ return Math.max(a, Math.min(b,x)); }

  function chirpMass(m1, m2) {
    // m1, m2 in solar masses
    const M = m1 + m2;
    const eta = (m1*m2)/(M*M);
    return M * Math.pow(eta, 3/5);
  }

  function symmetricMassRatio(m1, m2) {
    const M = m1 + m2;
    return (m1*m2)/(M*M);
  }

  function fISCO(m1, m2) {
    // Rough ISCO frequency for non-spinning BH binary in Hz (using total mass)
    const M = (m1+m2) * MSUN;
    return (1/(6*Math.sqrt(6)*PI)) * (c*c*c)/(G*M);
  }

  function smoothstep(x) {
    // 0..1 -> 0..1 smooth
    return x*x*(3-2*x);
  }

  function generateWaveform(params) {
    const {m1,m2,distMpc,incDeg,tc,tauMs,dur,fs} = params;

    const n = Math.floor(dur * fs);
    const t0 = 0.0;
    const dt = 1/fs;

    // Derived quantities
    const Mc = chirpMass(m1,m2) * MSUN;         // kg
    const eta = symmetricMassRatio(m1,m2);
    const Mtot = (m1+m2) * MSUN;

    const D = distMpc * MPC;
    const inc = incDeg * PI/180;

    // Polarization factor (simple + polarization projection)
    const F = (1 + Math.cos(inc)*Math.cos(inc)) / 2;  // between 0.5 and 1

    // Inspiral frequency evolution (Newtonian leading order): f(t) ~ (tc - t)^(-3/8)
    // We'll pick a starting frequency from the window so that it stays within audio-ish range.
    const f_isco = fISCO(m1,m2);
    const f_merge = 0.6 * f_isco; // place "merger" below ISCO for smoothness
    const f_ring = 0.8 * f_isco;  // ringdown-ish

    // Amplitude scaling (not physical absolute strain; shaped to look right)
    // Use Mc^(5/3) f^(2/3) / D scaling and normalize to nice plot units.
    const A0 = 5e-22; // arbitrary base to get LIGO-like magnitudes on screen
    const K = A0 * F * (400/distMpc); // simple distance scaling around 400 Mpc

    // Ringdown parameters
    const tau = (tauMs/1000.0);                 // s
    const omega_ring = 2*PI*f_ring;

    const t = new Array(n);
    const h = new Array(n);

    // Phase integration
    let phi = 0;
    let prev_f = 30;

    // Build a transition around tc: inspiral for t<tc, ringdown for t>=tc
    for (let i=0;i<n;i++) {
      const ti = t0 + i*dt;
      t[i] = ti - tc; // plot centered around coalescence

      const dtc = (tc - ti);

      if (dtc > 0) {
        // Inspiral: f(t) = f0 * (dtc/dtc0)^(-3/8), but choose f0 dynamically
        // Choose dtc0 so that at ti=0 we are near some f_start ~ 25 Hz.
        const dtc0 = dur; // reference
        const f_start = 25;
        let f = f_start * Math.pow(dtc / dtc0, -3/8);
        f = clamp(f, 15, f_merge);

        // Phase increment
        phi += 2*PI * 0.5*(f + prev_f) * dt;
        prev_f = f;

        // amplitude ~ f^(2/3)
        const amp = K * Math.pow(f/50, 2/3);

        // Add a mild taper near merger
        const x = clamp(1 - dtc/0.25, 0, 1); // last 0.25s ramps
        const boost = 1 + 1.8*smoothstep(x); // merger “loudness”
        h[i] = boost * amp * Math.cos(phi);
      } else {
        // Ringdown: damped sinusoid starting at tc, continuous phase
        const tr = -dtc;
        const amp0 = K * Math.pow(f_merge/50, 2/3) * 2.8; // match-ish merger amp
        h[i] = amp0 * Math.exp(-tr/tau) * Math.cos(omega_ring*tr + phi);
      }
    }

    return {
      t, h,
      derived: {
        Mc_solar: chirpMass(m1,m2),
        eta,
        f_isco,
        f_merge,
        f_ring
      }
    };
  }

  // ---------- Plot ----------
  let initialized = false;

  function getParams() {
    // ensure m1 >= m2 for display niceness (swap if needed)
    let m1 = parseFloat($("m1").value);
    let m2 = parseFloat($("m2").value);
    if (m2 > m1) { const tmp=m1; m1=m2; m2=tmp; }
    return {
      m1, m2,
      distMpc: parseFloat($("dist").value),
      incDeg: parseFloat($("inc").value),
      tc: parseFloat($("tc").value),
      tauMs: parseFloat($("tau").value),
      dur: parseFloat($("dur").value),
      fs: parseInt($("fs").value, 10),
    };
  }

  function updateLabels(p, d) {
    setVal("m1", `${p.m1.toFixed(0)}`);
    setVal("m2", `${p.m2.toFixed(0)}`);
    setVal("dist", `${p.distMpc.toFixed(0)}`);
    setVal("inc", `${p.incDeg.toFixed(0)}`);
    setVal("tc", `${p.tc.toFixed(2)}`);
    setVal("tau", `${p.tauMs.toFixed(1)}`);
    setVal("dur", `${p.dur.toFixed(1)}`);
    setVal("fs", `${p.fs}`);

    $("derived").innerHTML =
      `Mc=${d.Mc_solar.toFixed(2)} M☉ · η=${d.eta.toFixed(3)}<br>` +
      `fISCO≈${d.f_isco.toFixed(0)} Hz · fmerge≈${d.f_merge.toFixed(0)} Hz`;
  }

  function render() {
    const p = getParams();
    const {t, h, derived} = generateWaveform(p);
    updateLabels(p, derived);

    const trace = {
      x: t,
      y: h,
      mode: "lines",
      name: "h(t)",
      hovertemplate: "t=%{x:.4f} s<br>h=%{y:.3e}<extra></extra>"
    };

    const layout = {
      paper_bgcolor: "rgba(0,0,0,0)",
      plot_bgcolor: "rgba(0,0,0,0)",
      margin: {l:60,r:20,t:30,b:55},
      xaxis: { title: "Time relative to coalescence (s)", gridcolor: "rgba(255,255,255,0.08)", zerolinecolor:"rgba(255,255,255,0.15)" },
      yaxis: { title: "Strain (arb. scaled)", gridcolor: "rgba(255,255,255,0.08)", zerolinecolor:"rgba(255,255,255,0.15)" },
      font: { color: "#e5e7eb" }
    };

    const config = { responsive: true, displaylogo: false };

    if (!initialized) {
      Plotly.newPlot("plot", [trace], layout, config);
      initialized = true;
    } else {
      Plotly.react("plot", [trace], layout, config);
    }
  }

  // Wire events
  sliders.forEach(s => s.addEventListener("input", render));
  $("reset").addEventListener("click", () => {
    Object.entries(defaults).forEach(([k,v]) => $(k).value = v);
    render();
  });

  render();
})();
</script>
</body>
</html>
